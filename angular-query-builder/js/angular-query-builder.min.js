/*! angular-query-builder - v1.0.0 - 2015-11-26 */
/*! https://github.com/niklr/angular-query-builder */
angular.module("angular-query-builder",["ngAnimate","templates-aqb","aqb.src.directives","aqb.src.helpers"]).factory("AppConfig",function(){var a,b;return{setMaxConditions:function(b){a=b},getMaxConditions:function(){return a},setMaxGroups:function(a){b=a},getMaxGroups:function(){return b}}}),angular.module("aqb.src.directives",["aqb.src.directives.search-group","aqb.src.directives.search-condition"]),angular.module("aqb.src.directives.search-condition",[]).directive("searchCondition",["$http","$timeout","GuidHelper",function(a,b,c){return{scope:{condition:"=",conditionIndex:"=",sourceType:"="},templateUrl:"directives/search-condition.tpl.html",controller:["$scope","$element","$attrs","$transclude",function(d,e,f,g){function h(b){function c(c,d){var f=[];return a.get(b+c).then(function(a){return e={},$.each(a.data,function(){var a=this.displayName;this.isTypeahead=!0,e[a]=this,f.push(a)}),d(f)},function(a){return f})}var e={},f=$("#"+l),g=f.data("typeahead");g?g.source=c:f.typeahead({minLength:0,source:c,updater:function(a){return d.inputItem=angular.copy(e[a]),a}})}function i(){var a=$("#"+l).data("typeahead");a&&(a.source=[])}function j(){d.condition.sourceField&&d.sourceType&&(d.selectedSourceField=_.find(d.sourceType.sourceFields,function(a){return a.name===d.condition.sourceField.name}))}function k(){d.selectedSourceField&&(d.selectedComparisonOperator=_.find(d.selectedSourceField.comparisonOperators,function(a){return a.name===d.condition.comparisonOperator.name}))}var l=c.create();d.searchConditionInputItemId=l,j(),d.$watch("selectedSourceField",function(){d.selectedSourceField&&(d.condition.sourceField={name:d.selectedSourceField.name,displayName:d.selectedSourceField.displayName})}),k(),d.$watch("selectedComparisonOperator",function(a,c){d.selectedComparisonOperator&&(a!==c&&(d.inputItem=void 0),d.condition.comparisonOperator={name:d.selectedComparisonOperator.name,displayName:d.selectedComparisonOperator.displayName},d.selectedComparisonOperator.typeaheadUrl?b(function(){h(d.selectedComparisonOperator.typeaheadUrl)},0):i())}),d.inputItem=d.condition.inputItem,d.$watch("inputItem.displayName",function(){d.inputItem&&(d.inputItem.isTypeahead||(d.inputItem.data=d.inputItem.displayName),d.condition.inputItem=d.inputItem)}),d.canAddCondition=d.$parent.canAddCondition,d.addCondition=d.$parent.addCondition,d.removeCondition=d.$parent.removeCondition}]}}]),angular.module("aqb.src.directives.search-group",["aqb.src.helpers.recursion"]).directive("searchGroup",["$timeout","AppConfig","RecursionHelper",function(a,b,c){return{scope:{searchContainer:"=",groups:"=",groupIndex:"=",sourceTypes:"=",logicalOperators:"="},templateUrl:"directives/search-group.tpl.html",controller:["$scope","$element","$attrs","$transclude",function(a,c,d,e){function f(){a.group.sourceType&&(a.selectedSourceType=_.find(a.sourceTypes,function(b){return b.name===a.group.sourceType.name}))}function g(){a.group.logicalOperator&&(a.selectedLogicalOperator=_.find(a.logicalOperators,function(b){return b.name===a.group.logicalOperator.name}))}function h(a,b){if(a&&a.groups&&a.groups instanceof Array){b+=a.groups.length;for(var c=0;c<a.groups.length;c++)b=h(a.groups[c],b)}return b}a.group=a.groups[a.groupIndex],f(),a.selectSourceType=function(b){a.group.sourceType={name:b.name,displayName:b.displayName},f()},g(),a.selectLogicalOperator=function(b){a.group.logicalOperator={name:b.name,displayName:b.displayName},g()};var i=b.getMaxGroups();a.canAddGroup=function(){var b=!1;if(!i||0>=i)b=!0;else{var c=0;c=h(a.searchContainer,c),b=i>=c+1}return b},a.canRemoveGroup=function(){var b=0;return b=h(a.searchContainer,b),b>1&&a.group!==a.searchContainer.groups[0]},a.addGroup=function(){var b=a.sourceTypes[0],c=a.logicalOperators[0],d={sourceType:{name:b.name,displayName:b.displayName},logicalOperator:{name:c.name,displayName:c.displayName},conditions:[{}]};void 0===a.group.groups&&(a.group.groups=[]),a.group.groups.push(d)},a.removeGroup=function(){if(a.group!==a.searchContainer.groups[0]){var b=a.groups.indexOf(a.group);b>-1&&a.groups.splice(b,1)}};var j=b.getMaxConditions();a.canAddCondition=function(b){var c=!1,d=1;return a.group.conditions&&a.group.conditions instanceof Array&&(d=a.group.conditions.length),c=(!j||0>=j)&&b+1===d?!0:j>=d+1&&b+1===d},a.addCondition=function(b){var c=!1;if(b?b.$valid&&(c=!0):c=!0,c){var d={};a.group.conditions.push(d)}},a.removeCondition=function(b){a.group.conditions.splice(b,1)}}],compile:function(a){return c.compile(a)}}}]),angular.module("aqb.src.helpers.guid",[]).factory("GuidHelper",function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return{create:function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}}),angular.module("aqb.src.helpers",["aqb.src.helpers.guid","aqb.src.helpers.recursion"]),angular.module("aqb.src.helpers.recursion",[]).factory("RecursionHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]);